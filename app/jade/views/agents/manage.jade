include ../../modules/mixins.jade

//- 顶部操作栏
+action-bar
	li
		+tooltip('新建代理商', 'top', 'newAgent(agentsForm)')
			+glyphicon('plus')
	li
		+tooltip('', 'top', 'globalToggleSearch()')
			+glyphicon('search')

//- 搜索
+linkage-search('search()')

table.uu-table(ng-show='agents')
	+theadplus()(operation='工具', ng-dblclick="chooseTh('table-cols')")
	tbody
		tr(ng-repeat='agent in agents' ng-dblclick='editagent(agent.agent_code)')
			td(ng-bind='agent.agent_code' ng-show='ths[0].isChecked')
			td(ng-bind='agent.agent_date' ng-show='ths[1].isChecked')
			td(ng-bind='agent.agent_desc' ng-show='ths[2].isChecked')
			td(ng-bind='agent.status | mapper:"agent"' ng-show='ths[3].isChecked')
			td(ng-bind='agent.warehouse_name' ng-show='ths[4].isChecked')
			td(ng-bind='agent.create_time' ng-show='ths[5].isChecked')
			td(ng-bind='agent.creator' ng-show='ths[6].isChecked')
			td(ng-bind='agent.update_time' ng-show='ths[7].isChecked')
			td(ng-bind='agent.updater' ng-show='ths[8].isChecked')
			td.nowrap
				+tooltip('查看', 'top', 'editagent(agent.agent_code, agent.status)')
					+glyphicon('eye-open') &nbsp;

				+tooltip('取消入库单', 'top', 'cancelagent(agent.agent_code, $index)')
					+glyphicon('trash') &nbsp;

uu-pagination(records='agents.meta.recordsCount', per-page='agents.meta.pageSize' page='agents.meta.pageNo' model='searchModel' action='getagentList()')

//- 代理商modal
+modal('agents-form', 'modal-lg')
	.modal-header
		button.close(data-dismiss='modal', aria-hidden='true') &times;
		h4.modal-title 新建联系人
	.modal-body
		//- 将form放在uu-pane层级下会导致newagent(agentsForm)找不到agentsForm
		form.form-horizontal(name='agentsForm' novalidate ng-class='{sumitted: agentsForm.$sumitted}')
			fieldset
				legend 基本信息
				table.form-table
					tr
						+input('姓名', 'name')(uu-name ng-model='agent.name' required)
						+input('联系电话', 'form-telphone')(uu-phone ng-model='agent.phone' required)
					tr
						+input('登录名', 'username')(ng-model='agent.username' required)
						+input('初始密码', 'password')(ng-model='agent.password' required)
					tr
						+input('渠道经理', 'manager')(ng-model='agent.manager' required)
						+input('合同签约时间', 'contractDate')(ng-model='agent.contractDate' uu-date-picker required)
					tr
						+input('起订日期', 'startDate')(ng-model='agent.startDate' uu-date-picker required)
						+input('结束日期', 'enddate')(ng-model='agent.enddate' uu-date-picker required)
					tr
						+input('缴纳代理费', 'paid')(uu-float ng-model='agent.paid' required)
						+contract-type('合同类型', 'contract-type', 3)(ng-model='agent.contractType' required)
					tr
						+input-address('地址', 'order-address', 3)(ng-province-model='agent.province' ng-city-model='agent.city' ng-addr-model='agent.address' ng-required='true')

	.modal-footer
		button.btn.uu-btn.btn-primary(ng-click='saveAgent(agentsForm)' ng-disabled='agentsForm.processing') 保存
		button.btn.uu-btn(data-dismiss='modal') 取消


//- 商品详情Modal
+submodal('good-details-form')
	.modal-header
		button.close(data-dismiss='modal', aria-hidden='true') &times;
		h4.modal-title 修改商品详情
	.modal-body
		form.form-horizontal(name='productDetailsForm' novalidate ng-class='{sumitted: productDetailsForm.$sumitted}')
			fieldset
				legend 商品详情
				table.form-table.form-table-single
					tr
						+input('数量', 'qty')(uu-num ng-model='productTmpGood.qty' required)

	.modal-footer
		button.btn.uu-btn.btn-primary(ng-click='saveGoodToProduct(productDetailsForm)') 保存
		button.btn.uu-btn(data-dismiss='modal') 取消

//- 更改显示列
include ../../modules/table-ths.jade
